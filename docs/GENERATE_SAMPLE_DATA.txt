Generate sample data — quick guide
=================================

Purpose
-------
This short guide shows two simple ways to run the repository's sample-data generator: one for
PowerShell (Windows) and one for Bash (macOS / Linux). It also includes examples, tips and
troubleshooting for the common UNIQUE constraint error when re-running the script against an
existing local database.

Location
--------
- Script: `scripts/generate_sample_data.py` (run from the repository root)
- This guide: `docs/GENERATE_SAMPLE_DATA.txt`

Prerequisites
-------------
- A working Python 3.11+ installation (3.12 recommended)
- A virtual environment for the backend (recommended path: `backend/collegeEventsWeb/.venv`)
- The project's migrations applied (see `manage.py migrate`)

Recommended workflow (repo root)
--------------------------------
The generator expects to be run from the repository root. It imports the Django project and
creates users, venues, events, and tickets directly in the project's database (usually
`backend/collegeEventsWeb/db.sqlite3` in dev setups).

PowerShell (Windows)
---------------------
1. Open PowerShell and change to the repo root.
2. Activate the project's venv and run the generator:

```powershell
cd backend\collegeEventsWeb
.\.venv\Scripts\Activate.ps1
cd ..\..
# run the generator from the repo root
python .\scripts\generate_sample_data.py --venues 4 --events-per-venue 5 --students 50 --organizers 4 --registrations-per-event 10
```

Notes:
- If activation is blocked, allow it for the session:
  ```powershell
  Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope Process -Force
  . .\.venv\Scripts\Activate.ps1
  ```

Bash / macOS / Linux
---------------------
1. Open a terminal and change to the repo root.
2. Activate the backend venv and run the generator:

```bash
cd backend/collegeEventsWeb
source .venv/bin/activate
cd ../..
python ./scripts/generate_sample_data.py --venues 4 --events-per-venue 5 --students 50 --organizers 4 --registrations-per-event 10
```

Running without activating the venv
----------------------------------
If you prefer to call the venv Python directly (useful in CI or when not activating shells):

PowerShell:
```powershell
.\backend\collegeEventsWeb\.venv\Scripts\python.exe .\scripts\generate_sample_data.py --venues 2
```

Bash:
```bash
backend/collegeEventsWeb/.venv/bin/python3 ./scripts/generate_sample_data.py --venues 2
```

Generator options (examples)
----------------------------
- `--venues N` — number of venues to create
- `--events-per-venue M` — number of events per venue
- `--students K` — number of student users to create
- `--organizers O` — number of organizer users to create
- `--registrations-per-event R` — how many students are registered per event

Example (small):
```bash
python ./scripts/generate_sample_data.py --venues 2 --events-per-venue 3 --students 20 --organizers 3 --registrations-per-event 6
```

Troubleshooting
---------------
1) `UNIQUE constraint failed: users.email`

Cause: the generator uses deterministic email addresses (e.g. `student1@example.com`,
`organizer1@example.com`). If you run it again on the same local DB you will hit the unique
constraint because those users already exist.

Fixes:
- (Destructive but simple) Delete the local sqlite DB and re-run migrations, then re-run the
  generator.
  PowerShell:
  ```powershell
  Remove-Item backend\collegeEventsWeb\db.sqlite3 -Force
  cd backend\collegeEventsWeb
  .\.venv\Scripts\Activate.ps1
  python manage.py migrate --noinput
  ```
  Bash:
  ```bash
  rm backend/collegeEventsWeb/db.sqlite3
  cd backend/collegeEventsWeb
  source .venv/bin/activate
  python manage.py migrate --noinput
  ```

- (Non-destructive) Run the generator with smaller counts or alter the script to skip users
  that already exist. See the next section for a suggested small patch to make the generator
  skip existing emails.

Suggested idempotency patch (optional)
-------------------------------------
If you'd like the generator to be safe to re-run, a simple change is to check for existing
users before creating them. Example (pseudocode):

```python
from django.contrib.auth import get_user_model
User = get_user_model()
if not User.objects.filter(email=email).exists():
    User.objects.create_user(...)
else:
    # optionally update or skip
    continue
```

Converting to a Django management command
----------------------------------------
If you prefer `python manage.py generate_sample_data ...` I can convert the script into a
management command. This makes the script integrate with Django's runtime and avoids the need
to run it from the repo root.

Next steps
----------
- Commit this guide (`docs/GENERATE_SAMPLE_DATA.txt`) to the repository (I can do this for you).
- Add the optional idempotency check to `scripts/generate_sample_data.py` so it is safe to re-run.
- Convert the script to a management command (optional).

If you'd like, tell me which of the next steps to do and I will implement it.

---
End of guide
