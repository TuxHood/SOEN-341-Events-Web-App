Quickstart — React (Vite) + Django REST

This guide gets a teammate from a fresh clone to a running local dev environment (backend + frontend) on Windows (PowerShell) or macOS/Linux (bash). It focuses on copy‑pasteable commands and common tasks.

Prerequisites
- Node.js (LTS), Python 3.11+ (3.12 recommended), Git
- Optional: PostgreSQL (project defaults to SQLite for local dev)

1) Clone and open the repo

```powershell
git clone <repo-url>
cd SOEN-341-Events-Web-App
code .
```

2) Backend quickstart (Django)

Follow these steps from the repo root. If you prefer automation, use the helper scripts:
- Windows: `scripts\start-backend.ps1`
- macOS/Linux: `scripts/start-backend.sh`

- Create and activate a venv (one-time per machine):

Windows (PowerShell):
```powershell
cd backend\collegeEventsWeb
python -m venv .venv  # create venv if missing
 .\.venv\Scripts\Activate.ps1
```

macOS/Linux (bash):
```bash
cd backend/collegeEventsWeb
python3 -m venv .venv  # create venv if missing
source .venv/bin/activate
```

- Install dependencies:

Windows (PowerShell):
```powershell
& '.\.venv\Scripts\python.exe' -m pip install --upgrade pip setuptools wheel
if (Test-Path requirements.txt) {
  & '.\.venv\Scripts\pip.exe' install -r requirements.txt
} else {
  & '.\.venv\Scripts\pip.exe' install django==5.2.7 djangorestframework django-cors-headers djangorestframework-simplejwt python-dotenv
}
```

macOS/Linux (bash):
```bash
python -m pip install --upgrade pip setuptools wheel
if [ -f requirements.txt ]; then
  pip install -r requirements.txt
else
  pip install django==5.2.7 djangorestframework django-cors-headers djangorestframework-simplejwt python-dotenv
fi
```

Apply migrations and create an admin (interactive):

Windows (PowerShell):
```powershell
& '.\.venv\Scripts\python.exe' manage.py migrate --noinput
& '.\.venv\Scripts\python.exe' manage.py createsuperuser --email you@example.com
```

macOS/Linux (bash):
```bash
python manage.py migrate --noinput
python manage.py createsuperuser --email you@example.com
```

Optional — only if you changed models locally and need new migrations:

Windows (PowerShell):
```powershell
& '.\.venv\Scripts\python.exe' manage.py makemigrations --check --dry-run
& '.\.venv\Scripts\python.exe' manage.py makemigrations  # run if previous exits with code 1
```

macOS/Linux (bash):
```bash
python manage.py makemigrations --check --dry-run || python manage.py makemigrations
```

Start the dev server:

Windows (PowerShell):
```powershell
& '.\.venv\Scripts\python.exe' manage.py runserver 8000
```

macOS/Linux (bash):
```bash
python manage.py runserver 8000
```

If you encounter migration errors (for example: "no such column: \"start_at\"" or attempts to drop a column that doesn't exist), it's often because your local SQLite file and the migration files have diverged. On a local dev machine one safe option is to remove the local SQLite DB and re-run migrations from scratch. WARNING: this deletes local data.

PowerShell one-liner (destructive; local dev only):

```powershell
Remove-Item backend\collegeEventsWeb\db.sqlite3 -Force -ErrorAction SilentlyContinue; Set-Location backend\collegeEventsWeb; & '.\.venv\Scripts\Activate.ps1'; & '.\.venv\Scripts\python.exe' manage.py migrate --noinput; & '.\.venv\Scripts\python.exe' manage.py createsuperuser
```

Or run the same steps separately for clarity:

```powershell
# delete local sqlite DB
Remove-Item backend\collegeEventsWeb\db.sqlite3 -Force

# go to project and activate venv
Set-Location backend\collegeEventsWeb
& '.\.venv\Scripts\Activate.ps1'

# recreate DB schema and optionally create a superuser
& '.\.venv\Scripts\python.exe' manage.py migrate --noinput
& '.\.venv\Scripts\python.exe' manage.py createsuperuser --email you@example.com
```

Quick notes
- Admin UI: http://127.0.0.1:8000/admin/
- API roots: /api/events/, /api/users/, /api/tickets/

3) Frontend quickstart (Vite + React)

Open a second terminal (repo root) and run the frontend dev server. You can either use the helper scripts (recommended) which auto-install a few runtime packages, or run npm directly.

Windows (PowerShell) — recommended (uses helper script):
```powershell
# from repo root
./scripts/start-frontend.ps1
```

macOS/Linux (bash) — recommended (uses helper script):
```bash
# from repo root
./scripts/start-frontend.sh
```

Manual (npm) — first time only:
```bash
cd frontend
npm install
npm run dev
```

Vite runs at http://localhost:5173 by default (may use 5174 if 5173 is busy). The frontend is configured to proxy `/api` → `http://localhost:8000`.

4) Helper scripts (recommended)

The repository includes small helper scripts that automate common developer tasks such as installing deps and starting dev servers. They also take care of a few runtime packages that the app expects (for example: `recharts`, `axios`, and `jsqr`) so you get a consistent environment across machines.

Windows (PowerShell):
```powershell
# backend (one terminal)
./scripts/start-backend.ps1

# frontend (open a second terminal)
./scripts/start-frontend.ps1
```

macOS/Linux (bash):
```bash
# backend (one terminal)
./scripts/start-backend.sh

# frontend (open a second terminal)
./scripts/start-frontend.sh
```

Notes about the frontend helper scripts:
- They use `npm --prefix <frontend>` so installs and dev starts are executed from the `frontend` folder even when you run the script from the repo root.
- On first run they will run `npm install` if `node_modules` is missing.
- They will also ensure `recharts`, `axios`, and `jsqr` are installed (common runtime deps used by the UI). This prevents Vite import errors when certain optional packages are not yet present.

5) Admin account patterns (safe)

Interactive (recommended):

```powershell
# run from backend\collegeEventsWeb with the venv activated
& '.\.venv\Scripts\python.exe' manage.py createsuperuser --email you@example.com
```

Non-interactive pattern (use env vars or a secret store; avoid hardcoding passwords):

```powershell
# set session vars (or read from secret manager)
$env:NEW_ADMIN_EMAIL='admin@example.com'
$env:NEW_ADMIN_NAME='Admin Name'
$env:NEW_ADMIN_PASSWORD='S3cureP@ssw0rd'  # prefer Read-Host or secret store

cd backend\collegeEventsWeb
.\.venv\Scripts\Activate.ps1
& '.\.venv\Scripts\python.exe' - <<'PY'
import os
os.environ.setdefault('DJANGO_SETTINGS_MODULE','collegeEventsWeb.settings')
import django; django.setup()
from user_accounts.models import User
email=os.environ.get('NEW_ADMIN_EMAIL')
name=os.environ.get('NEW_ADMIN_NAME')
password=os.environ.get('NEW_ADMIN_PASSWORD')
if not User.objects.filter(email=email).exists():
    User.objects.create_superuser(email=email, name=name, password=password)
    print('Superuser created:', email)
else:
    u = User.objects.get(email=email)
    u.set_password(password)
    u.role = User.Role.ADMIN
    u.status = User.Status.ACTIVE
    u.is_staff = True
    u.is_superuser = True
    u.save()
    print('User promoted to superuser (password updated):', email)
PY
```

There is also a `create_admin.py` template in the repo root — do not commit secrets into it. Prefer environment variables or a secret manager.

6) Discovering routes (list URL patterns)

Option A — install `django-extensions` (dev only):

```powershell
cd backend\collegeEventsWeb
.\.venv\Scripts\Activate.ps1
& '.\.venv\Scripts\pip.exe' install django-extensions
# add 'django_extensions' to INSTALLED_APPS in settings.py (dev only)
& '.\.venv\Scripts\python.exe' manage.py show_urls
```

Option B — inline (no extra deps):

```powershell
cd backend\collegeEventsWeb
.\.venv\Scripts\Activate.ps1
& '.\.venv\Scripts\python.exe' - <<'PY'
import os
os.environ.setdefault('DJANGO_SETTINGS_MODULE','collegeEventsWeb.settings')
import django; django.setup()
from django.urls import get_resolver
for p in get_resolver().url_patterns:
    print(p)
PY
```

7) How to call the API

Use the browser (DRF browsable API), curl, or PowerShell's `Invoke-RestMethod` for quick checks:

```powershell
Invoke-RestMethod -Uri http://127.0.0.1:8000/api/events/ -Method GET
```

Login via API (example): POST to `/api/users/login` with JSON `{"email":"...","password":"..."}` — the backend returns tokens and sets an HttpOnly cookie as configured.

8) Troubleshooting tips

- If venv activation is blocked, allow it for your session:

```powershell
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope Process -Force
. .\.venv\Scripts\Activate.ps1
```

- To recreate a broken venv:

```powershell
Remove-Item -Recurse -Force .\.venv
python -m venv .venv
& '.\.venv\Scripts\python.exe' -m pip install --upgrade pip setuptools wheel
& '.\.venv\Scripts\pip.exe' install -r requirements.txt
```

- CSRF cookie issues (common when frontend calls backend directly):
  - Prefer using Vite's proxy (default) so the browser treats API requests as same-origin.
  - If you call the backend directly on `http://localhost:8000`, ensure `CORS_ALLOW_CREDENTIALS = True` and set cookie SameSite/secure flags correctly in `settings.py` (dev-only changes may be needed).

- If migrations fail because migrations and DB are out of sync, follow the "delete DB and recreate" steps above (dev-only, destructive) or fake-apply migrations if you need to preserve data.

9) Improvements I can add (pick one)

- Convert `create_admin.py` into a management command: `manage.py create_admin --email ...` (recommended)
- Add DRF OpenAPI + docs endpoints (`/openapi/`, `/docs/`)
- Add a management command to print friendly routes

If you'd like, tell me which improvement to implement and I will make the change and verify it locally.

--

Quicker commands reference

Windows (PowerShell):
```powershell
Set-Location backend\collegeEventsWeb
& '.\.venv\Scripts\Activate.ps1'
& '.\.venv\Scripts\python.exe' manage.py migrate --noinput
& '.\.venv\Scripts\python.exe' manage.py createsuperuser --email you@example.com
Set-Location ..\..\frontend
npm install
npm run dev
```

macOS/Linux (bash):
```bash
cd backend/collegeEventsWeb
source .venv/bin/activate
python manage.py migrate --noinput
python manage.py createsuperuser --email you@example.com
cd ../../frontend
npm install
npm run dev
```

# Omit --password to be prompted securely.
```

2) Wrapper (prompts securely)
```powershell
# from repo root
.\scripts\create-admin.ps1
```

Note: this repository contains multiple Django project folders in history. The canonical dev project is
`backend/collegeEventsWeb` — all `manage.py` commands shown in this guide assume you are in that directory
or explicitly call that `manage.py`. If you see an older `manage.py` under `backend/`, it is legacy and may be
archived or removed to avoid confusion.


